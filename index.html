<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>BLADE: HIGH-VISIBILITY</title>

  <!-- ✅ 정상 경로: RPG-GAME/css.html/style.css -->
  <link rel="stylesheet" href="./css.html/style.css?v=9" />

  <!-- ✅ CSS/JS 로드 실패해도 화면에 에러가 뜨도록 최소 스타일 -->
  <style>
    html,body{height:100%;margin:0;background:#000;overflow:hidden;font-family:Arial, sans-serif;}
    canvas{display:block;}
    #boot{
      position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
      background:rgba(0,0,0,.92);color:#fff;z-index:9998;text-align:center;padding:20px;
      font:700 18px/1.5 Arial, sans-serif;
    }
    #debug{
      position:fixed;left:10px;bottom:10px;z-index:9999;display:none;
      max-width:min(94vw,980px);white-space:pre-wrap;font:12px/1.4 ui-monospace,Consolas,monospace;
      background:rgba(0,0,0,.78);color:#fff;border:1px solid rgba(255,255,255,.28);
      padding:10px;border-radius:12px
    }
  </style>
</head>

<body>
  <div id="boot">LOADING...</div>

  <!-- HUD -->
  <div id="ui">
    <div id="stats">LV.1 에테르 기사</div>
    <div class="bar-container"><div id="hp-fill"></div></div>
    <div id="meta">
      <span class="pill">WAVE <b id="wave">1</b></span>
      <span class="pill">GOLD <b id="gold">0</b></span>
      <span class="pill">TOKEN <b id="token">1</b>/1</span>
    </div>
    <div id="awk-timer" style="display:none;">OVERDRIVE: 10s</div>
    <div id="cooldowns">
      DASH <b id="cd-dash">0.0</b>s ·
      Q <b id="cd-q">0.0</b>s ·
      E <b id="cd-e">0.0</b>s ·
      R <b id="cd-r">0.0</b>s
    </div>
    <div id="score">SCORE: 0</div>
    <div class="bar-container exp" style="height:8px;"><div id="exp-fill"></div></div>
  </div>

  <div id="item-msg"></div>
  <div id="hit-flash" aria-hidden="true"></div>

  <button id="pause-btn" aria-label="pause">⏸</button>

  <!-- Touch controls -->
  <div id="touch" aria-hidden="true">
    <div class="touch-col">
      <div class="tbtn" id="t-left">◀</div>
      <div class="tbtn" id="t-right">▶</div>
    </div>
    <div class="touch-col">
      <div class="tbtn big" id="t-jump">⤒</div>
      <div class="tbtn" id="t-dash">⇢</div>
    </div>
    <div class="touch-col">
      <div class="tbtn" id="t-q">Q</div>
      <div class="tbtn" id="t-e">E</div>
      <div class="tbtn" id="t-r">R</div>
    </div>
  </div>

  <canvas id="gameCanvas"></canvas>

  <!-- TITLE -->
  <div id="title-menu" class="overlay" style="display:none;">
    <h1 class="title">BLADE</h1>

    <div class="panel wide">
      <div class="row spread">
        <div class="small-note" id="title-active">ACTIVE SLOT: 1</div>
        <div class="btn-row">
          <button class="menu-btn mini" id="btn-open-options-title">OPTIONS</button>
        </div>
      </div>
      <div class="small-note" id="token-line-title">이어하기 토큰: 1/1</div>
    </div>

    <div class="panel wide">
      <div class="label">SAVE SLOTS (3)</div>

      <div class="slots">
        <div class="slot-card">
          <div class="slot-head">
            <div class="slot-title">SLOT 1 <span id="slot-active-1" class="badge active" style="display:none;">ACTIVE</span></div>
            <span id="slot-badge-1" class="badge">EMPTY</span>
          </div>
          <pre id="slot-meta-1" class="meta">No save data.</pre>
          <div class="slot-actions">
            <button class="menu-btn mini" id="slot-load-1">LOAD</button>
            <button class="menu-btn mini" id="slot-new-1">NEW</button>
            <button class="menu-btn mini danger" id="slot-del-1">DELETE</button>
          </div>
        </div>

        <div class="slot-card">
          <div class="slot-head">
            <div class="slot-title">SLOT 2 <span id="slot-active-2" class="badge active" style="display:none;">ACTIVE</span></div>
            <span id="slot-badge-2" class="badge">EMPTY</span>
          </div>
          <pre id="slot-meta-2" class="meta">No save data.</pre>
          <div class="slot-actions">
            <button class="menu-btn mini" id="slot-load-2">LOAD</button>
            <button class="menu-btn mini" id="slot-new-2">NEW</button>
            <button class="menu-btn mini danger" id="slot-del-2">DELETE</button>
          </div>
        </div>

        <div class="slot-card">
          <div class="slot-head">
            <div class="slot-title">SLOT 3 <span id="slot-active-3" class="badge active" style="display:none;">ACTIVE</span></div>
            <span id="slot-badge-3" class="badge">EMPTY</span>
          </div>
          <pre id="slot-meta-3" class="meta">No save data.</pre>
          <div class="slot-actions">
            <button class="menu-btn mini" id="slot-load-3">LOAD</button>
            <button class="menu-btn mini" id="slot-new-3">NEW</button>
            <button class="menu-btn mini danger" id="slot-del-3">DELETE</button>
          </div>
        </div>
      </div>

      <div class="small-note">※ 자동 저장: 보스 클리어(보상 선택 직후)만</div>
      <div class="small-note">※ GAME OVER에서 LOAD는 “토큰 1회” 있을 때만 가능</div>
    </div>
  </div>

  <!-- PAUSE -->
  <div id="pause-menu" class="overlay" style="display:none;">
    <h1 class="title">PAUSED</h1>

    <div class="panel">
      <div id="active-slot-note" class="small-note">ACTIVE: SLOT 1</div>
      <div id="token-line-pause" class="small-note">이어하기 토큰: 1/1</div>

      <div class="mini-slots">
        <button class="menu-btn mini" id="mini-slot-1">SLOT 1</button>
        <button class="menu-btn mini" id="mini-slot-2">SLOT 2</button>
        <button class="menu-btn mini" id="mini-slot-3">SLOT 3</button>
      </div>

      <div class="btn-col">
        <button class="menu-btn" id="btn-resume">RESUME</button>
        <button class="menu-btn" id="btn-save">SAVE (ACTIVE SLOT)</button>
        <button class="menu-btn" id="btn-open-options-pause">OPTIONS</button>
        <button class="menu-btn ghost" id="btn-restart">RESTART (ACTIVE SLOT)</button>
        <button class="menu-btn ghost" id="btn-to-title">TITLE MENU</button>
      </div>
    </div>
  </div>

  <!-- REWARD -->
  <div id="reward-menu" class="overlay" style="display:none;">
    <h1 class="title">BOSS CLEARED</h1>
    <div id="reward-sub" class="small-note">WAVE 1 → 2</div>

    <div class="panel wide">
      <div class="reward-grid">
        <button class="reward-card" id="reward-0">
          <div class="r-name" id="reward-name-0">Reward A</div>
          <div class="r-desc" id="reward-desc-0">Desc</div>
        </button>
        <button class="reward-card" id="reward-1">
          <div class="r-name" id="reward-name-1">Reward B</div>
          <div class="r-desc" id="reward-desc-1">Desc</div>
        </button>
        <button class="reward-card" id="reward-2">
          <div class="r-name" id="reward-name-2">Reward C</div>
          <div class="r-desc" id="reward-desc-2">Desc</div>
        </button>
      </div>
      <div class="small-note">선택 즉시: 체크포인트 자동 저장 + 토큰 1회 충전</div>
    </div>
  </div>

  <!-- OPTIONS -->
  <div id="options-menu" class="overlay" style="display:none;">
    <h1 class="title">OPTIONS</h1>
    <div class="panel">
      <label class="opt"><input type="checkbox" id="opt-shake" /><span>SCREEN SHAKE</span></label>
      <label class="opt"><input type="checkbox" id="opt-flash" /><span>HIT FLASH</span></label>
      <label class="opt"><input type="checkbox" id="opt-slowmo" /><span>SLOW-MO (PERFECT DODGE)</span></label>
      <div class="small-note">※ 옵션은 저장됩니다(로컬스토리지).</div>
      <div class="btn-row center">
        <button class="menu-btn" id="btn-options-back">BACK</button>
      </div>
    </div>
  </div>

  <!-- GAME OVER -->
  <div id="overlay" class="overlay" style="display:none;">
    <h1 class="title">GAME OVER</h1>
    <div id="final-result" class="small-note">SCORE: 0 | LEVEL: 1</div>
    <div id="token-line-over" class="small-note">이어하기 토큰: 1/1</div>
    <div id="over-note" class="small-note">불러올 슬롯을 선택하세요.</div>

    <div class="panel">
      <div class="btn-col">
        <button class="menu-btn" id="go-load-1">LOAD SLOT 1</button>
        <button class="menu-btn" id="go-load-2">LOAD SLOT 2</button>
        <button class="menu-btn" id="go-load-3">LOAD SLOT 3</button>
      </div>

      <div class="btn-row center">
        <button class="menu-btn ghost" id="btn-retry">RETRY (NEW)</button>
        <button class="menu-btn ghost" id="btn-over-title">TITLE</button>
      </div>
    </div>
  </div>

  <div id="debug"></div>

  <!-- ✅ game.js 로더(실패 시 에러 표시) -->
  <script>
    (function(){
      const debugEl = document.getElementById("debug");
      const bootEl = document.getElementById("boot");
      const show = (msg) => { debugEl.style.display="block"; debugEl.textContent=msg; };

      const s = document.createElement("script");
      s.src = "./js.html/game.js?v=9";
      s.onload = () => {
        setTimeout(() => {
          if(window.__BLADE_BOOTED){
            bootEl.style.display = "none";
          }else{
            show("game.js는 로드되었지만 초기화 신호가 없습니다.\n콘솔(F12) 에러를 확인하세요.");
          }
        }, 120);
      };
      s.onerror = () => {
        show("game.js 로드 실패!\n경로: ./js.html/game.js\n※ js.html은 ‘폴더’여야 합니다(파일 아님)\n※ game.js가 game.js.txt가 아닌지 확인");
        bootEl.innerHTML = "LOADING 실패 (debug 확인)";
      };
      document.body.appendChild(s);
    })();
  </script>
</body>
</html>
